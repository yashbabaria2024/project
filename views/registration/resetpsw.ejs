<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/major.css">
    <title>User Detail</title>
</head>
<body >
    <style>
    .center
    {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 250px;
    }

    .box
    {
        background-color: aliceblue;
        height: 500px;
        width: 500px;
         border-radius: 10px;
    }

    .btn
    {
        position: relative;
        top:50px;
        left: 142px;
    }

    h3
    {
        text-align: center;
        padding: 10px;
    }

    #cap
    {
        margin: 0 auto;
    }
   
    div
    {
        display: flex;
        align-items: center;
        flex-direction: column;
        justify-content: center;
    }
    .cap
    {
        position: relative;
        background-color: bisque;
        padding: 10px 35px;
        border-radius: 12px;
        left: 111px;
        top: 42px;
    }

    #id_cap {
  display: flex;
  align-items: center;
  flex-direction: column;
  justify-content: center;
  position: relative;
  pointer-events: none;
    }
</style>
<div  class="center" >
    <div class="box">
        <h3>Reset Password</h3>
        <form method="post" onsubmit="return valid()" >
<table>
    <tr>
        <td><label for="email" >Email</label></td>
        <td id="td"><input type="text" class="form-control" name="emailreset"
                class="form-control" id="id_username" placeholder="Enter Register Email">
        </td>
    </tr>
    <tr> 
        <td><label for="password">Enter Captcha</label></td>
        <td><input type="text" class="form-control" name="captcha" id="id_captcha"
                class="form-control" placeholder="Enter Captcha">
        </td>
    </tr>
    <tr>
       <td> <div class="cap" id="id_cap"> </div></td>
    </tr>
    <tr>
       <td> <input type="submit" name="send" id="id_send" class="btn btn-primary"
                value="Send"></td>
                
    </tr>
    <!-- <td><a href="">forgot password?</a></td> -->
</table>
</form>
</div>
</div>
<% if(locals.alert){ %>
    <script>alert("Email id does not exist")</script>
    <% } %>
<script>

    function captchaGenerateFun()
    {
        const character = 'abcdefghijklmnopqrstuvwxyz1234567890'
         let activelink = ''
            for(let i=0; i<5; i++)
            {
                activelink += character.charAt(Math.floor(Math.random()* character.length))
            } 
            document.getElementById('id_cap').innerHTML = activelink
            // flag = activelink
    }
   
    captchaGenerateFun()

    function captchaFun()
    {
       
    let cap =  document.getElementById('id_cap').innerHTML
    let captcha = document.getElementById('id_captcha').value

       if(captcha == "")
        {
        let error = document.createElement("span");
        error.setAttribute("class", "invalid-feedback");
        error.setAttribute("id", "remove")
        error.textContent = "Please Enter Captcha"
        document.getElementById(`id_captcha`).setAttribute("class", "form-control is-invalid")
        document.getElementById(`id_captcha`).setAttribute("class", "form-control is-invalid")
        // document.getElementById(`${id2.id}`).focus()
        document.getElementById(`id_captcha`).after(error);
        flag = false
         }
         else if(cap != captcha)
        {
            let error = document.createElement("span");
            error.setAttribute("class", "invalid-feedback");
            error.setAttribute("id", "remove")
            error.textContent = "Your Captcha not matched"
            document.getElementById(`id_captcha`).setAttribute("class", "form-control is-invalid")
            document.getElementById(`id_captcha`).setAttribute("class", "form-control is-invalid")
            // document.getElementById(`${id2.id}`).focus()
            document.getElementById(`id_captcha`).after(error);
            flag = false
         }
 
}


function emailFun(id) {
    let nm = document.getElementById(`${id.id}`).value
    var regex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
    if (nm == "") {

        let error = document.createElement("span");
        error.setAttribute("class", "invalid-feedback");
        error.setAttribute("id", "remove")
        error.textContent = "Please enter " + id.name
        document.getElementById(`${id.id}`).setAttribute("class", "form-control is-invalid")
        document.getElementById(`${id.id}`).focus()
        document.getElementById(`${id.id}`).after(error);
        flag = false

    }
    else if (!nm.match(regex)) {

        let error = document.createElement("span");
        error.setAttribute("class", "invalid-feedback");
        error.setAttribute("id", "remove")
        error.textContent = "Please enter valid " + id.name
        document.getElementById(`${id.id}`).setAttribute("class", "form-control is-invalid")
        document.getElementById(`${id.id}`).focus()
        document.getElementById(`${id.id}`).after(error);
        flag = false
    }
}

    

let flag

    function valid()
    {
        arr = ["id_username","id_captcha"]
        arr.forEach(element => {
        
        if (document.querySelector("#" + element).value != "") {
            let rt = document.querySelector("#" + element).setAttribute("class", "form-control")

        }
    });
    flag = true

    let span = document.querySelectorAll('span')
    for (let i = 0; i < span.length; i++) {
        span[i].remove()
    }
    emailFun(id_username)
    captchaFun()
    // validationFUn()

          if(flag == false)
        {
            console.log(flag);
            return false
        }
        
    }    
    
    const d = document.getElementById("id_cap");
      d.addEventListener("contextmenu", (e) => {e.preventDefault()});
      

</script>
</body>
</html>